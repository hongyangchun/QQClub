<!--pages/index/index.wxml-->
<view class="container page-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="hero-section" wx:if="{{userInfo}}">
    <view class="user-card">
      <view class="card-body">
        <view class="user-header">
          <view class="user-avatar-wrapper">
            <image class="avatar avatar-large" src="{{userInfo.avatar_url}}" mode="aspectFill"></image>
            <view class="avatar-ring"></view>
          </view>
          <view class="user-info">
            <view class="greeting">æ—©ä¸Šå¥½ ğŸ‘‹</view>
            <view class="username">{{userInfo.nickname}}</view>
            <view class="user-status">å‡†å¤‡å¥½äº†å¼€å§‹ä»Šå¤©çš„é˜…è¯»ä¹‹æ—…å—ï¼Ÿ</view>
          </view>
          <view class="user-actions">
            <view class="action-btn" bindtap="goToProfile">
              <text class="action-icon">ğŸ‘¤</text>
            </view>
          </view>
        </view>

        <!-- ä»Šæ—¥é˜…è¯»ç»Ÿè®¡ -->
        <view class="reading-stats">
          <view class="stat-item">
            <view class="stat-number">7</view>
            <view class="stat-label">è¿ç»­å¤©æ•°</view>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <view class="stat-number">23</view>
            <view class="stat-label">å·²è¯»ä¹¦ç±</view>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <view class="stat-number">156</view>
            <view class="stat-label">é˜…è¯»æ—¶é•¿</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•æç¤º -->
  <view class="hero-section" wx:if="{{!userInfo}}">
    <view class="welcome-card">
      <view class="card-body text-center">
        <view class="welcome-icon">ğŸ“š</view>
        <view class="welcome-title">å¼€å¯é˜…è¯»ä¹‹æ—…</view>
        <view class="welcome-subtitle">åŠ å…¥æ°æ°è¯»ä¹¦ä¼šï¼Œå‘ç°æ›´å¥½çš„è‡ªå·±</view>
        <button class="btn btn-primary btn-welcome" bindtap="goToLogin">
          <text>ç«‹å³å¼€å§‹</text>
          <text class="btn-arrow">â†’</text>
        </button>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œåŒº -->
  <view class="quick-actions" wx:if="{{userInfo}}">
    <view class="section-header">
      <view class="section-title">å¿«é€Ÿæ“ä½œ</view>
    </view>
    <view class="action-grid">
      <view class="action-card primary-action" bindtap="goToMyActivities">
        <view class="action-bg"></view>
        <view class="action-content">
          <view class="action-icon">ğŸ¯</view>
          <view class="action-title">æˆ‘çš„æ´»åŠ¨</view>
          <view class="action-desc">ç®¡ç†æˆ‘çš„æ´»åŠ¨</view>
        </view>
      </view>
      <view class="action-card secondary-action" bindtap="goToPosts">
        <view class="action-bg"></view>
        <view class="action-content">
          <view class="action-icon">ğŸ’¬</view>
          <view class="action-title">è‡ªç”±äº¤æµ</view>
          <view class="action-desc">æŸ¥çœ‹äº¤æµå†…å®¹</view>
        </view>
      </view>
      <view class="action-card warning-action" bindtap="goToMessages">
        <view class="action-bg"></view>
        <view class="action-content">
          <view class="action-icon">ğŸ“¬</view>
          <view class="action-title">æ¶ˆæ¯åŠ¨æ€</view>
          <view class="action-desc">æŸ¥çœ‹é€šçŸ¥æé†’</view>
          <view class="message-badge" wx:if="{{unreadCount > 0}}">{{unreadCount}}</view>
        </view>
      </view>
      <view class="action-card success-action" bindtap="goToStats">
        <view class="action-bg"></view>
        <view class="action-content">
          <view class="action-icon">ğŸ“Š</view>
          <view class="action-title">æ•°æ®ç»Ÿè®¡</view>
          <view class="action-desc">é˜…è¯»è¿›åº¦</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-section" wx:if="{{userInfo}}">
    <!-- æœ€æ–°æ´»åŠ¨ -->
    <view class="content-block" wx:if="{{recentEvents.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <text class="title-icon">ğŸ“š</text>
          <text>æœ€æ–°æ´»åŠ¨</text>
        </view>
        <view class="section-more" bindtap="goToEvents">
          <text>æŸ¥çœ‹å…¨éƒ¨</text>
          <text class="more-arrow">â€º</text>
        </view>
      </view>
      <view class="event-list">
        <view class="event-card" wx:for="{{recentEvents}}" wx:key="id" bindtap="goToEventDetail" data-id="{{item.id}}">
          <view class="event-header">
            <view class="event-status">
              <view class="status-dot {{item.approval_status === 'approved' ? 'approved' : item.approval_status === 'rejected' ? 'rejected' : 'pending'}}"></view>
              <text class="status-text">{{item.approval_status_text}}</text>
            </view>
            <view class="event-badge">{{item.status_text}}</view>
          </view>
          <view class="event-body">
            <view class="event-title">{{item.title}}</view>
            <view class="event-book">ğŸ“– {{item.book_name}}</view>
            <view class="event-meta">
              <view class="meta-item">
                <text class="meta-icon">ğŸ‘¥</text>
                <text class="meta-text">{{item.participants_count}}/{{item.max_participants}}</text>
              </view>
              <view class="meta-item">
                <text class="meta-icon">ğŸ“…</text>
                <text class="meta-text">{{item.date_range}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœ€æ–°åŠ¨æ€ -->
    <view class="content-block" wx:if="{{recentPosts.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <text class="title-icon">âœï¸</text>
          <text>è¯»ä¹¦åŠ¨æ€</text>
        </view>
        <view class="section-more" bindtap="goToPosts">
          <text>æŸ¥çœ‹å…¨éƒ¨</text>
          <text class="more-arrow">â€º</text>
        </view>
      </view>
      <view class="post-list">
        <view class="post-card" wx:for="{{recentPosts}}" wx:key="id" bindtap="goToPostDetail" data-id="{{item.id}}">
          <view class="post-header">
            <view class="author-info">
              <image class="avatar avatar-small" src="{{item.author_info.avatar_url}}" mode="aspectFill"></image>
              <view class="author-details">
                <view class="author-name">{{item.author_info.nickname}}</view>
                <view class="post-time">{{item.created_at_relative}}</view>
              </view>
            </view>
            <view class="post-menu">â‹¯</view>
          </view>
          <view class="post-body">
            <view class="post-title">{{item.title}}</view>
            <view class="post-content">{{item.content_preview}}</view>
          </view>
          <view class="post-footer">
            <view class="post-stats">
              <view class="stat-item">
                <text class="stat-icon">â¤ï¸</text>
                <text class="stat-text">{{item.likes_count}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ’¬</text>
                <text class="stat-text">{{item.comments_count}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{recentEvents.length === 0 && recentPosts.length === 0}}">
      <view class="empty-illustration">
        <text class="empty-emoji">ğŸŒ±</text>
      </view>
      <view class="empty-title">å¼€å§‹ä½ çš„é˜…è¯»ä¹‹æ—…</view>
      <view class="empty-desc">åŠ å…¥æ´»åŠ¨æˆ–å‚ä¸äº¤æµï¼Œå¼€å§‹ç²¾å½©çš„é˜…è¯»ä½“éªŒ</view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">ç²¾å½©å†…å®¹åŠ è½½ä¸­...</text>
  </view>
</view>