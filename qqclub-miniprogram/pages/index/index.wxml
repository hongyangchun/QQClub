<!--pages/index/index.wxml-->
<view class="container page-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="card user-card" wx:if="{{userInfo}}">
    <view class="card-body">
      <view class="flex items-center">
        <image class="avatar avatar-medium mr-3" src="{{userInfo.avatar_url}}" mode="aspectFill"></image>
        <view class="flex-1">
          <view class="text-medium mb-1">{{userInfo.nickname}}</view>
          <view class="text-small text-secondary">æ¬¢è¿æ¥åˆ°QQè¯»ä¹¦ä¼š</view>
        </view>
        <view class="btn btn-outline btn-small" bindtap="goToProfile">ä¸ªäººä¸­å¿ƒ</view>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•æç¤º -->
  <view class="card login-prompt" wx:if="{{!userInfo}}">
    <view class="card-body text-center">
      <view class="text-large mb-3">ç™»å½•QQè¯»ä¹¦ä¼š</view>
      <view class="text-secondary mb-4">å‘ç°é˜…è¯»çš„ä¹è¶£ï¼Œç»“è¯†å¿—åŒé“åˆçš„æœ‹å‹</view>
      <button class="btn btn-primary btn-block" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
    </view>
  </view>

  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="feature-grid" wx:if="{{userInfo}}">
    <view class="feature-item" bindtap="goToEvents">
      <view class="feature-icon">ğŸ“š</view>
      <view class="feature-title">è¯»ä¹¦æ´»åŠ¨</view>
      <view class="feature-desc">å‚åŠ ç²¾å½©æ´»åŠ¨</view>
    </view>
    <view class="feature-item" bindtap="goToPosts">
      <view class="feature-icon">âœï¸</view>
      <view class="feature-title">æ¯æ—¥æ‰“å¡</view>
      <view class="feature-desc">è®°å½•é˜…è¯»å¿ƒå¾—</view>
    </view>
    <view class="feature-item" bindtap="goToCreateEvent">
      <view class="feature-icon">â•</view>
      <view class="feature-title">åˆ›å»ºæ´»åŠ¨</view>
      <view class="feature-desc">ç»„ç»‡è¯»ä¹¦æ´»åŠ¨</view>
    </view>
    <view class="feature-item" bindtap="goToCreatePost">
      <view class="feature-icon">ğŸ’­</view>
      <view class="feature-title">å‘å¸ƒåŠ¨æ€</view>
      <view class="feature-desc">åˆ†äº«é˜…è¯»æ„Ÿæ‚Ÿ</view>
    </view>
  </view>

  <!-- æœ€æ–°æ´»åŠ¨ -->
  <view class="section" wx:if="{{userInfo && recentEvents.length > 0}}">
    <view class="section-header">
      <view class="section-title">æœ€æ–°æ´»åŠ¨</view>
      <view class="section-more" bindtap="goToEvents">æŸ¥çœ‹æ›´å¤š</view>
    </view>
    <view class="event-list">
      <view class="event-item card" wx:for="{{recentEvents}}" wx:key="id" bindtap="goToEventDetail" data-id="{{item.id}}">
        <view class="card-body">
          <view class="event-status mb-2">
            <text class="tag {{item.approval_status === 'approved' ? 'tag-success' : item.approval_status === 'rejected' ? 'tag-error' : 'tag-secondary'}}">
              {{item.approval_status_text}}
            </text>
            <text class="tag tag-primary">{{item.status_text}}</text>
          </view>
          <view class="event-title text-medium mb-2">{{item.title}}</view>
          <view class="event-book text-small text-secondary mb-2">ğŸ“– {{item.book_name}}</view>
          <view class="event-info flex justify-between text-small text-hint">
            <text>ğŸ‘¥ {{item.participants_count}}/{{item.max_participants}}äºº</text>
            <text>ğŸ“… {{item.date_range}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°åŠ¨æ€ -->
  <view class="section" wx:if="{{userInfo && recentPosts.length > 0}}">
    <view class="section-header">
      <view class="section-title">æœ€æ–°åŠ¨æ€</view>
      <view class="section-more" bindtap="goToPosts">æŸ¥çœ‹æ›´å¤š</view>
    </view>
    <view class="post-list">
      <view class="post-item card" wx:for="{{recentPosts}}" wx:key="id" bindtap="goToPostDetail" data-id="{{item.id}}">
        <view class="card-body">
          <view class="post-author flex items-center mb-2">
            <image class="avatar avatar-small mr-2" src="{{item.author_info.avatar_url}}" mode="aspectFill"></image>
            <view class="flex-1">
              <view class="text-small">{{item.author_info.nickname}}</view>
              <view class="text-mini text-hint">{{item.created_at_relative}}</view>
            </view>
          </view>
          <view class="post-title text-medium mb-2">{{item.title}}</view>
          <view class="post-content text-small text-secondary mb-2">{{item.content_preview}}</view>
          <view class="post-stats flex items-center text-small text-hint">
            <text class="mr-3">â¤ï¸ {{item.likes_count}}</text>
            <text class="mr-3">ğŸ’¬ {{item.comments_count}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{userInfo && recentEvents.length === 0 && recentPosts.length === 0}}">
    <view class="empty-icon">ğŸ“š</view>
    <view class="empty-text">æš‚æ— æ´»åŠ¨æˆ–åŠ¨æ€</view>
    <view class="empty-desc">å¿«æ¥åˆ›å»ºç¬¬ä¸€ä¸ªæ´»åŠ¨æˆ–å‘å¸ƒåŠ¨æ€å§ï¼</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>