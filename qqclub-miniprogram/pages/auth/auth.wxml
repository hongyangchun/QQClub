<!--pages/auth/auth.wxml-->
<view class="auth-container">
  <!-- 头部Logo区域 -->
  <view class="auth-header">
    <view class="logo">📚</view>
    <view class="title">QQ读书会</view>
    <view class="subtitle">发现阅读的乐趣，结识志同道合的朋友</view>
  </view>

  <!-- 登录表单 -->
  <view class="auth-form">
    <!-- 快速登录（模拟） -->
    <view class="login-section">
      <view class="section-title">快速登录</view>
      <view class="quick-login">
        <button class="login-btn btn btn-primary btn-block" bindtap="mockLogin">
          <text class="login-icon">🚀</text>
          <text>模拟登录（开发测试）</text>
        </button>
      </view>
    </view>

    <!-- 微信登录 -->
    <view class="login-section">
      <view class="section-title">微信登录</view>
      <view class="wechat-login">
        <button
          class="login-btn btn btn-success btn-block"
          open-type="getUserInfo"
          bindgetuserinfo="wechatLogin"
          disabled="{{wechatLoading}}"
        >
          <text class="login-icon" wx:if="{{!wechatLoading}}">👤</text>
          <view class="loading-spinner" wx:if="{{wechatLoading}}"></view>
          <text>{{wechatLoading ? '登录中...' : '微信一键登录'}}</text>
        </button>
      </view>
    </view>

    <!-- 手机号登录 -->
    <view class="login-section">
      <view class="section-title">手机号登录</view>
      <form bindsubmit="phoneLogin">
        <view class="form-item">
          <input
            class="form-input"
            type="number"
            placeholder="请输入手机号"
            maxlength="11"
            value="{{phoneNumber}}"
            bindinput="onPhoneNumberInput"
          />
        </view>
        <view class="form-item">
          <view class="flex">
            <input
              class="form-input flex-1"
              type="number"
              placeholder="请输入验证码"
              maxlength="6"
              value="{{verifyCode}}"
              bindinput="onVerifyCodeInput"
            />
            <button
              class="btn btn-outline ml-2"
              bindtap="sendVerifyCode"
              disabled="{{codeSending || countdown > 0}}"
            >
              {{codeSending ? '发送中...' : countdown > 0 ? countdown + 's' : '获取验证码'}}
            </button>
          </view>
        </view>
        <button
          class="login-btn btn btn-primary btn-block"
          form-type="submit"
          disabled="{{phoneLoading}}"
        >
          <text class="login-icon" wx:if="{{!phoneLoading}}">📱</text>
          <view class="loading-spinner" wx:if="{{phoneLoading}}"></view>
          <text>{{phoneLoading ? '登录中...' : '登录'}}</text>
        </button>
      </form>
    </view>
  </view>

  <!-- 用户协议 -->
  <view class="auth-agreement">
    <view class="agreement-content">
      <label class="agreement-checkbox" bindtap="toggleAgreement">
        <checkbox value="agreed" checked="{{agreed}}" />
        <text>我已阅读并同意</text>
      </label>
      <text class="agreement-link" bindtap="showUserAgreement">《用户协议》</text>
      <text>和</text>
      <text class="agreement-link" bindtap="showPrivacyPolicy">《隐私政策》</text>
    </view>
  </view>

  <!-- 底部装饰 -->
  <view class="auth-footer">
    <view class="footer-text">让阅读成为一种生活方式</view>
  </view>
</view>

<!-- 协议弹窗 -->
<view class="modal" wx:if="{{showAgreementModal}}">
  <view class="modal-mask" bindtap="hideAgreementModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">{{agreementTitle}}</view>
      <view class="modal-close" bindtap="hideAgreementModal">×</view>
    </view>
    <view class="modal-body">
      <scroll-view scroll-y class="agreement-text">
        <text>{{agreementContent}}</text>
      </scroll-view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-primary btn-block" bindtap="hideAgreementModal">我知道了</button>
    </view>
  </view>
</view>