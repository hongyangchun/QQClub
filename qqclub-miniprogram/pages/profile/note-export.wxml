<!--pages/profile/note-export.wxml-->
<view class="container page-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-icon">ğŸ“‹</text>
        <text class="title-text">ç¬”è®°å¯¼å‡º</text>
      </view>
      <view class="header-desc">å¯¼å‡ºæ‚¨åœ¨å…±è¯»æ´»åŠ¨ä¸­æäº¤çš„ä½œä¸šå†…å®¹</view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="filter-section">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input"
               placeholder="æœç´¢æ´»åŠ¨åç§°"
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               bindconfirm="onSearchConfirm" />
        <text class="clear-icon" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
      </view>
    </view>

    <view class="filter-tabs">
      <view class="tab-item {{dateFilter === 'all' ? 'active' : ''}}"
            bindtap="changeDateFilter"
            data-filter="all">
        <text>å…¨éƒ¨æ—¶é—´</text>
      </view>
      <view class="tab-item {{dateFilter === 'recent' ? 'active' : ''}}"
            bindtap="changeDateFilter"
            data-filter="recent">
        <text>æœ€è¿‘30å¤©</text>
      </view>
      <view class="tab-item {{dateFilter === 'month' ? 'active' : ''}}"
            bindtap="changeDateFilter"
            data-filter="month">
        <text>æœ¬æœˆ</text>
      </view>
    </view>

    <view class="filter-tabs">
      <view class="tab-item {{statusFilter === 'all' ? 'active' : ''}}"
            bindtap="changeStatusFilter"
            data-filter="all">
        <text>å…¨éƒ¨çŠ¶æ€</text>
      </view>
      <view class="tab-item {{statusFilter === 'ongoing' ? 'active' : ''}}"
            bindtap="changeStatusFilter"
            data-filter="ongoing">
        <text>è¿›è¡Œä¸­</text>
      </view>
      <view class="tab-item {{statusFilter === 'completed' ? 'active' : ''}}"
            bindtap="changeStatusFilter"
            data-filter="completed">
        <text>å·²ç»“æŸ</text>
      </view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-actions" wx:if="{{activities.length > 0}}">
    <view class="batch-left">
      <checkbox class="select-all-checkbox"
                checked="{{selectedActivities.length === activities.length && activities.length > 0}}"
                bindtap="toggleSelectAll" />
      <text class="batch-text">å…¨é€‰ ({{selectedActivities.length}}/{{activities.length}})</text>
    </view>
    <view class="batch-right">
      <view class="format-selector">
        <text class="format-label">å¯¼å‡ºæ ¼å¼:</text>
        <view class="format-options">
          <view class="format-option {{exportFormat === 'txt' ? 'active' : ''}}"
                bindtap="changeExportFormat"
                data-format="txt">
            <text>TXT</text>
          </view>
          <view class="format-option {{exportFormat === 'md' ? 'active' : ''}}"
                bindtap="changeExportFormat"
                data-format="md">
            <text>MD</text>
          </view>
          <view class="format-option {{exportFormat === 'pdf' ? 'active' : ''}}"
                bindtap="changeExportFormat"
                data-format="pdf">
            <text>PDF</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="activities-list">
    <view class="activity-item"
          wx:for="{{activities}}"
          wx:key="id"
          bindtap="toggleActivitySelection"
          data-id="{{item.id}}">

      <view class="item-left">
        <checkbox class="activity-checkbox"
                  checked="{{selectedActivities.includes(item.id)}}"
                  catchtap="toggleActivitySelection"
                  data-id="{{item.id}}" />
      </view>

      <view class="item-content">
        <view class="activity-header">
          <view class="activity-title">{{item.title}}</view>
          <view class="activity-status status-{{item.status}}">{{item.status_text}}</view>
        </view>

        <view class="activity-info">
          <text class="info-item">ğŸ“– {{item.book_name}}</text>
          <text class="info-item">ğŸ‘¥ {{item.participants_count}}äººå‚ä¸</text>
          <text class="info-item">ğŸ“ {{item.my_homework_count}}ç¯‡ç¬”è®°</text>
        </view>

        <view class="activity-meta">
          <text class="meta-item">å¼€å§‹: {{item.start_date}}</text>
          <text class="meta-item">ç»“æŸ: {{item.end_date}}</text>
          <text class="meta-item role-{{item.role}}">
            {{item.role === 'organizer' ? 'ğŸ‘‘ é¢†è¯»äºº' : 'ğŸ“š å‚ä¸è€…'}}
          </text>
        </view>
      </view>

      <view class="item-right">
        <text class="detail-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{activities.length === 0 && !loading}}">
    <view class="empty-illustration">
      <text class="empty-emoji">ğŸ“</text>
    </view>
    <view class="empty-title">æš‚æ— å…±è¯»æ´»åŠ¨</view>
    <view class="empty-desc">æ‚¨è¿˜æ²¡æœ‰å‚ä¸ä»»ä½•å…±è¯»æ´»åŠ¨ï¼Œå¿«å»åŠ å…¥ä¸€ä¸ªå§ï¼</view>
    <view class="empty-actions">
      <button class="btn btn-primary" bindtap="goToEvents">
        <text>æµè§ˆæ´»åŠ¨</text>
        <text class="btn-arrow">â†’</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions" wx:if="{{activities.length > 0}}">
    <view class="action-buttons">
      <button class="btn btn-secondary"
              bindtap="previewExport"
              disabled="{{selectedActivities.length === 0}}">
        <text class="btn-icon">ğŸ‘ï¸</text>
        <text>é¢„è§ˆå¯¼å‡º</text>
      </button>
      <button class="btn btn-primary"
              bindtap="exportNotes"
              disabled="{{selectedActivities.length === 0 || loading}}">
        <text class="btn-icon">ğŸ“¥</text>
        <text>{{loading ? 'å¯¼å‡ºä¸­...' : 'å¯¼å‡ºç¬”è®°'}}</text>
      </button>
    </view>
  </view>
</view>