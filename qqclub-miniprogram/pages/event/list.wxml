<!--pages/event/list.wxml-->
<view class="container page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-icon">ğŸ“š</text>
        <text>å…±è¯»åŒº</text>
      </view>
      <view class="header-actions">
        <button class="create-btn" bindtap="goToCreateEvent">
          <text class="btn-icon">âœï¸</text>
          <text class="btn-text">åˆ›å»ºå…±è¯»</text>
        </button>
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view
        class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="all"
      >
        <text class="tab-text">å…¨éƒ¨</text>
        <view class="tab-indicator" wx:if="{{currentFilter === 'all'}}"></view>
      </view>
      <view
        class="filter-tab {{currentFilter === 'enrolling' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="enrolling"
      >
        <text class="tab-text">æŠ¥åä¸­</text>
        <view class="tab-badge" wx:if="{{enrollingCount > 0}}">{{enrollingCount}}</view>
        <view class="tab-indicator" wx:if="{{currentFilter === 'enrolling'}}"></view>
      </view>
      <view
        class="filter-tab {{currentFilter === 'in_progress' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="in_progress"
      >
        <text class="tab-text">è¿›è¡Œä¸­</text>
        <view class="tab-indicator" wx:if="{{currentFilter === 'in_progress'}}"></view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="events-container" wx:if="{{events.length > 0}}">
    <view class="events-list">
      <view
        class="event-card"
        wx:for="{{events}}"
        wx:key="id"
        bindtap="goToEventDetail"
        data-id="{{item.id}}"
      >
        <!-- æ´»åŠ¨å¤´éƒ¨ -->
        <view class="event-header">
          <view class="event-title">{{item.title}}</view>
          <view class="event-status status-{{item.status}}">{{item.status_text}}</view>
        </view>

        <!-- æ´»åŠ¨å†…å®¹ -->
        <view class="event-body">
          <view class="event-book">
            <text class="book-icon">ğŸ“–</text>
            <text class="book-name">{{item.book_name}}</text>
          </view>

          <view class="event-info">
            <view class="info-item">
              <text class="info-icon">ğŸ‘¤</text>
              <text class="info-text">{{item.leader_name}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">ğŸ“…</text>
              <text class="info-text">{{item.date_range}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">ğŸ‘¥</text>
              <text class="info-text">{{item.participants_count}}äººå‚ä¸</text>
            </view>
          </view>
        </view>

        <!-- æ´»åŠ¨æ“ä½œ -->
        <view class="event-actions">
          <button
            class="action-btn join-btn"
            bindtap="joinEvent"
            data-id="{{item.id}}"
            catch:tap="true"
            wx:if="{{item.can_join}}"
          >
            <text class="btn-icon">ğŸŸ¢</text>
            <text class="btn-text">åŠ å…¥å…±è¯»</text>
          </button>

          <button
            class="action-btn observe-btn"
            bindtap="observeEvent"
            data-id="{{item.id}}"
            catch:tap="true"
            wx:if="{{item.can_observe}}"
          >
            <text class="btn-icon">ğŸ‘ï¸</text>
            <text class="btn-text">å›´è§‚å…±è¯»</text>
          </button>

          <view class="action-btn joined-btn" wx:if="{{item.is_participant}}">
            <text class="btn-icon">âœ…</text>
            <text class="btn-text">å·²åŠ å…¥</text>
          </view>

          <view class="action-btn observing-btn" wx:if="{{item.is_observer}}">
            <text class="btn-icon">ğŸ‘ï¸</text>
            <text class="btn-text">å›´è§‚ä¸­</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && events.length === 0}}">
    <view class="empty-illustration">
      <text class="empty-emoji">ğŸ“š</text>
    </view>
    <view class="empty-title">æš‚æ— å…±è¯»æ´»åŠ¨</view>
    <view class="empty-desc">å¿«æ¥åˆ›å»ºç¬¬ä¸€ä¸ªå…±è¯»æ´»åŠ¨å§ï¼</view>
    <button class="btn btn-primary" bindtap="goToCreateEvent">
      <text>åˆ›å»ºå…±è¯»æ´»åŠ¨</text>
      <text class="btn-arrow">â†’</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">ç²¾å½©æ´»åŠ¨åŠ è½½ä¸­...</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more-section" wx:if="{{hasMore && !loading}}">
    <button class="load-more-btn" bindtap="loadMore">
      <text class="load-text">åŠ è½½æ›´å¤š</text>
      <text class="load-icon">â†“</text>
    </button>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="end-reached" wx:if="{{!hasMore && events.length > 0}}">
    <view class="end-line"></view>
    <text class="end-text">å·²ç»åˆ°åº•äº†</text>
  </view>
</view>