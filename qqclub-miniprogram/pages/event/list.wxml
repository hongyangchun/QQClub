<!--pages/event/list.wxml-->
<view class="container page-container">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-icon">📚</text>
        <text>共读区</text>
      </view>
      <view class="header-actions">
        <button class="create-btn" bindtap="goToCreateEvent">
          <text class="btn-icon">✏️</text>
          <text class="btn-text">创建共读</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 状态筛选 -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view
        class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="all"
      >
        <text class="tab-text">全部</text>
        <view class="tab-indicator" wx:if="{{currentFilter === 'all'}}"></view>
      </view>
      <view
        class="filter-tab {{currentFilter === 'enrolling' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="enrolling"
      >
        <text class="tab-text">报名中</text>
        <view class="tab-badge" wx:if="{{enrollingCount > 0}}">{{enrollingCount}}</view>
        <view class="tab-indicator" wx:if="{{currentFilter === 'enrolling'}}"></view>
      </view>
      <view
        class="filter-tab {{currentFilter === 'in_progress' ? 'active' : ''}}"
        bindtap="changeFilter"
        data-filter="in_progress"
      >
        <text class="tab-text">进行中</text>
        <view class="tab-indicator" wx:if="{{currentFilter === 'in_progress'}}"></view>
      </view>
    </view>
  </view>

  <!-- 活动列表 -->
  <view class="events-container" wx:if="{{events.length > 0}}">
    <view class="events-list">
      <view
        class="event-card"
        wx:for="{{events}}"
        wx:key="id"
        bindtap="goToEventDetail"
        data-id="{{item.id}}"
      >
        <!-- 活动头部 -->
        <view class="event-header">
          <view class="event-title">{{item.title}}</view>
          <view class="event-status status-{{item.status}}">{{item.status_text}}</view>
        </view>

        <!-- 活动内容 -->
        <view class="event-body">
          <view class="event-book">
            <text class="book-icon">📖</text>
            <text class="book-name">{{item.book_name}}</text>
          </view>

          <view class="event-info">
            <view class="info-item">
              <text class="info-icon">👤</text>
              <text class="info-text">{{item.leader_name}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">📅</text>
              <text class="info-text">{{item.date_range}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">👥</text>
              <text class="info-text">{{item.participants_count}}人参与</text>
            </view>
          </view>
        </view>

        <!-- 活动操作 -->
        <view class="event-actions">
          <button
            class="action-btn join-btn"
            bindtap="joinEvent"
            data-id="{{item.id}}"
            catch:tap="true"
            wx:if="{{item.can_join}}"
          >
            <text class="btn-icon">🟢</text>
            <text class="btn-text">加入共读</text>
          </button>

          <button
            class="action-btn observe-btn"
            bindtap="observeEvent"
            data-id="{{item.id}}"
            catch:tap="true"
            wx:if="{{item.can_observe}}"
          >
            <text class="btn-icon">👁️</text>
            <text class="btn-text">围观共读</text>
          </button>

          <view class="action-btn joined-btn" wx:if="{{item.is_participant}}">
            <text class="btn-icon">✅</text>
            <text class="btn-text">已加入</text>
          </view>

          <view class="action-btn observing-btn" wx:if="{{item.is_observer}}">
            <text class="btn-icon">👁️</text>
            <text class="btn-text">围观中</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && events.length === 0}}">
    <view class="empty-illustration">
      <text class="empty-emoji">📚</text>
    </view>
    <view class="empty-title">暂无共读活动</view>
    <view class="empty-desc">快来创建第一个共读活动吧！</view>
    <button class="btn btn-primary" bindtap="goToCreateEvent">
      <text>创建共读活动</text>
      <text class="btn-arrow">→</text>
    </button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">精彩活动加载中...</text>
  </view>

  <!-- 加载更多 -->
  <view class="load-more-section" wx:if="{{hasMore && !loading}}">
    <button class="load-more-btn" bindtap="loadMore">
      <text class="load-text">加载更多</text>
      <text class="load-icon">↓</text>
    </button>
  </view>

  <!-- 没有更多 -->
  <view class="end-reached" wx:if="{{!hasMore && events.length > 0}}">
    <view class="end-line"></view>
    <text class="end-text">已经到底了</text>
  </view>
</view>